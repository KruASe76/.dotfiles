#!/bin/bash

sudo echo -n

if [ -d $HOME/sysinfo ]
then
    base_dir=$HOME/sysinfo/
elif [ -d $HOME/.dotfiles/sysinfo ]
then
    base_dir=$HOME/.dotfiles/sysinfo/
else
    echo "Unable to locate a diretory with sysinfo." >&2
    echo "Should be either ~/sysinfo/ or ~/.dotfiles/sysinfo/" >&2
    exit 2
fi


echo "COPYING SYSTEM CONFIGURATION FILES..."
sudo cp $base_dir/dnf.conf /etc/dnf/dnf.conf
sudo cp -ru $base_dir/yum.repos.d/ /etc/
# sudo cp $base_dir/fstab /etc/fstab
sudo cp $base_dir/sshd_config /etc/ssh/sshd_config && sudo chown root:root /etc/ssh/sshd_config && sudo chmod a-rwx,u+rw /etc/ssh/sshd_config

echo "INSTALLING DNF PACKAGES..."
sudo dnf --refresh install -y gstreamer1-plugins-{bad-\*,good-\*,base} gstreamer1-plugin-openh264 gstreamer1-plugin-libav --exclude=gstreamer1-plugins-bad-free-devel
sudo dnf install -y lame\* --exclude=lame-devel
sudo dnf group upgrade -y --with-optional Multimedia
cat $base_dir/dnf-manual.txt | while read package
do
    sudo dnf install -y $package
done


echo -e "\n\n"
echo "INSTALLING FLATPAKS (FROM FLATHUB)..."
flatpak install -y flathub $(cat $base_dir/flatpak-flathub.txt)

if [ -s $base_dir/flatpak-fedora.txt ]
then
    echo -e "\n\n"
    echo "INSTALLING FLATPAKS (FROM FEDORA)..."
    flatpak install -y fedora $(cat $base_dir/flatpak-fedora.txt)
fi

if [ -s $base_dir/snap.txt ]
then
    echo -e "\n\n"
    echo "INSTALLING SNAPS..."
    sudo snap install $(cat $base_dir/snap.txt)
fi

echo "LOADING DCONF..."
sudo dconf load / < $base_dir/gnome-dconf.ini

unset base_dir dnf_log
